<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="style-theme.css">
  <link rel="stylesheet" href="style-admin.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6226206359050540" crossorigin="anonymous"></script>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="admin-header">
      <div class="admin-brand">
        <img src="logo.png" alt="All-In Chat Poker logo" class="brand-logo">
        <div>
          <h1>All-In Chat Poker Admin</h1>
          <p class="brand-subtitle">Control the table, manage players</p>
        </div>
      </div>
          <div class="header-actions">
            <div id="admin-countdown" class="countdown">00:00</div>
            <div id="admin-phase" class="phase-chip">Betting</div>
            <button id="admin-theme-toggle" class="btn btn-secondary btn-sm">Theme</button>
            <button id="btn-open-obs-overlay" class="btn btn-secondary btn-sm">OBS Overlay</button>
            <button id="btn-export" class="btn btn-secondary btn-sm">Export</button>
            <button id="btn-logout" class="btn btn-danger btn-sm">Logout</button>
          </div>
    </header>

    <main class="admin-main">
      <!-- Stats Grid -->
      <section class="stats-grid">
        <div class="stat-card">
          <h3>Total Players</h3>
          <div id="stat-total-players" class="stat-number">0</div>
        </div>
        <div class="stat-card">
          <h3>Total Balance</h3>
          <div id="stat-total-balance" class="stat-number">0</div>
        </div>
        <div class="stat-card">
          <h3>Top Winner</h3>
          <div id="stat-top-winner" class="stat-name">—</div>
        </div>
        <div class="stat-card">
          <h3>Biggest Win</h3>
          <div id="stat-biggest-win" class="stat-number">0</div>
        </div>
        <div class="stat-card">
          <h3>Pot</h3>
          <div id="admin-pot" class="stat-number">0</div>
          <div class="stat-sub">Current Bet: <span id="admin-current-bet">0</span></div>
        </div>
      </section>

      <!-- Lobby Controls -->
      <section class="control-panel">
        <h2>Shared Lobby (Multi-stream)</h2>
        <div class="control-card">
          <h4>Create Lobby Code</h4>
          <p class="muted">Generate a shared lobby code for multiple streamers. Overlays use the same code in the URL (?channel=&lt;code&gt;).</p>
          <div class="form-grid">
            <button id="btn-create-lobby" class="btn btn-primary btn-sm">Create Lobby</button>
            <input id="lobby-code-output" class="form-input" type="text" readonly placeholder="lobby code will appear here">
            <button id="btn-copy-lobby" class="btn btn-secondary btn-sm">Copy Code</button>
          </div>
          <div class="form-grid" style="margin-top:8px;">
            <input id="lobby-join-input" class="form-input" type="text" placeholder="Enter lobby code to join">
            <button id="btn-join-lobby" class="btn btn-success btn-sm">Join Lobby</button>
          </div>
          <small id="lobby-links" class="muted"></small>
        </div>
      </section>

      <!-- Control Panel -->
      <section class="control-panel">
        <h2>Game Controls</h2>
        <div class="control-buttons">
          <button id="btn-admin-start-round" class="btn btn-primary">
            Start Round
          </button>
          <button id="btn-admin-start-now" class="btn btn-success">
            Start Now
          </button>
          <button id="btn-admin-draw" class="btn btn-success">
            Process Draw
          </button>
          <button id="btn-reset-game" class="btn btn-warning">
            Reset Game
          </button>
        </div>
        <div class="mode-select">
          <label for="game-mode">Game Mode</label>
          <select id="game-mode" class="form-input" disabled>
            <option value="blackjack" selected>Blackjack (locked)</option>
          </select>
          <button id="btn-save-mode" class="btn btn-info btn-sm" disabled style="opacity:0.4; cursor:not-allowed;">Locked</button>
        </div>
        <div class="control-card">
          <h4>Adjust Player Balance</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="adjust-login">Player</label>
              <input id="adjust-login" type="text" class="form-input" placeholder="username">
            </div>
            <div class="form-group">
              <label for="adjust-amount">Amount</label>
              <input id="adjust-amount" type="number" class="form-input" placeholder="e.g. 500">
            </div>
            <div class="form-group">
              <label for="adjust-mode">Mode</label>
              <select id="adjust-mode" class="form-input">
                <option value="add">Add chips</option>
                <option value="set">Set exact balance</option>
              </select>
            </div>
          </div>
          <button id="btn-adjust-balance" class="btn btn-primary btn-sm" style="margin-top:8px;">Apply</button>
        </div>
        <div class="rules-card">
          <h4>Poker availability</h4>
          <ul>
            <li>Blackjack is the default for single-channel games.</li>
            <li>Poker is enabled only in shared lobbies (codes starting with <code>lobby-</code>) for Stream Together sessions.</li>
            <li>Use the lobby creator above to generate a shared code for multi-stream play.</li>
          </ul>
        </div>
        <div class="queue-display">
          <h4>Waiting Queue <span class="phase-chip subtle" id="queue-count">0</span></h4>
          <ol id="queue-list" class="leaderboard">
            <li>None</li>
          </ol>
        </div>
        <div class="rules-card">
          <h4>Last Payouts</h4>
          <ul id="admin-payouts" class="payouts-list">
            <li>None</li>
          </ul>
        </div>
      </section>

      <!-- Developer Controls -->
      <section class="control-panel">
        <h2>Developer / Overlay Tuning</h2>
        <div class="control-card">
          <p class="muted">Adjust live overlay feel for this channel: dealing speed, chip audio, and pot glow threshold.</p>
          <div class="form-grid dev-grid">
            <label>
              Deal delay per player
              <input id="dev-deal-base" type="range" min="0" max="0.6" step="0.02" value="0.18">
              <small class="muted">Current: <span id="dev-deal-base-val">0.18</span>s</small>
            </label>
            <label>
              Deal delay per card
              <input id="dev-deal-card" type="range" min="0" max="0.3" step="0.02" value="0.08">
              <small class="muted">Current: <span id="dev-deal-card-val">0.08</span>s</small>
            </label>
            <label>
              Chip sound volume
              <input id="dev-chip-volume" type="range" min="0" max="0.6" step="0.02" value="0.16">
              <small class="muted">Current: <span id="dev-chip-volume-val">0.16</span></small>
            </label>
            <label>
              Pot glow multiplier
              <input id="dev-pot-glow" type="range" min="1" max="20" step="0.5" value="5">
              <small class="muted">Current: <span id="dev-pot-glow-val">5</span>x min bet</small>
            </label>
            <label>
              Card back variant
              <select id="dev-card-variant" class="form-input">
                <option value="default">Default</option>
                <option value="emerald">Emerald</option>
                <option value="azure">Azure</option>
                <option value="magenta">Magenta</option>
                <option value="gold">Gold</option>
                <option value="custom">Custom tint</option>
              </select>
            </label>
            <label>
              Card back tint (custom)
              <input id="dev-card-tint" type="color" value="#0f7a62">
              <small class="muted">Used when variant is set to custom.</small>
            </label>
            <label>
              Avatar ring color
              <input id="dev-avatar-ring" type="color" value="#00d4a6">
            </label>
            <label>
              Profile card border
              <input id="dev-profile-border" type="color" value="#00d4a6">
            </label>
            <label>
              Table felt tint
              <input id="dev-table-tint" type="color" value="#0b4a3e">
            </label>
            <label>
              Table logo color
              <input id="dev-table-logo" type="color" value="#8ef5d0">
            </label>
          </div>
          <div class="control-row" style="margin-top:12px;">
            <button id="btn-apply-overlay-settings" class="btn btn-primary btn-sm">Push to overlays</button>
            <small class="muted">Applies to overlays using this channel/lobby.</small>
          </div>
          <div class="control-row">
            <button id="btn-refresh-catalog" class="btn btn-secondary btn-sm">Reload cosmetics catalog</button>
            <small class="muted">For QA: reloads catalog/ownership cache.</small>
          </div>
        </div>
      </section>

      <section class="control-panel">
        <h2>Alpha Test Checklist</h2>
        <div class="control-card">
          <ul class="rules-list">
            <li>Auth/roles: streamer/admin login works; admin endpoints blocked for normal users.</li>
            <li>Lobbies: create/join lobby; poker hidden on single-channel, visible on lobby- channels.</li>
            <li>Blackjack flow: start/end round; hit/stand/double/split/insurance; payouts and balances update.</li>
            <li>Overlay: deal/flip/chip animations; cosmetics render (card back, avatar ring, profile border, table tint/texture/logo).</li>
            <li>Cosmetics API: grant via admin, equip via profile; catalog loads.</li>
            <li>Pages: rules (blackjack/poker/hold’em), profile customize, marketplace, support mailto.</li>
            <li>Deploy: flyctl deploy --config fly.toml --no-cache after local smoke.</li>
          </ul>
        </div>
      </section>

      <!-- Profiles Section -->
      <section class="profiles-section">
        <h2>Player Profiles</h2>
        <div class="profiles-toolbar">
          <input
            type="search"
            id="profiles-search"
            class="search-input"
            placeholder="Search players..."
          >
          <button id="btn-refresh-profiles" class="btn btn-info btn-sm">
            Refresh
          </button>
        </div>

        <table class="profiles-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Display Name</th>
              <th>Balance</th>
              <th>Rounds Won</th>
              <th>Total Won</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="profiles-table-body">
            <!-- Profile rows will be rendered here -->
          </tbody>
        </table>
      </section>

      <!-- Audit Log -->
      <section class="audit-section">
        <h2>Unblock Audit Log</h2>
        <table class="audit-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Admin</th>
              <th>Target</th>
              <th>Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="audit-table-body">
            <!-- Audit entries will be rendered here -->
          </tbody>
        </table>
      </section>
    </main>
  </div>

  <!-- Edit Profile Modal -->
  <div id="edit-profile-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Profile</h2>
        <button type="button" class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="edit-profile-form" class="form">
          <div class="form-group">
            <label for="edit-login">Username</label>
            <input type="text" id="edit-login" readonly class="form-input">
          </div>
          <div class="form-group">
            <label for="edit-display-name">Display Name</label>
            <input type="text" id="edit-display-name" class="form-input">
          </div>
          <div class="form-group">
            <label for="edit-starting-chips">Starting Chips</label>
            <input type="number" id="edit-starting-chips" class="form-input" min="100" max="10000">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="modal-cancel">Cancel</button>
        <button type="button" class="btn btn-primary" id="modal-save">Save</button>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="toast-container" class="toast-container"></div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-wNqiR6UCbyaxTs3LpwBbUMkM94ePQz0cCVu3RHYZK8eC6xkzGdY9lKDrV1Q9l2Kk" crossorigin="anonymous"></script>
  <script src="client.js"></script>
  <script src="admin.js"></script>
</body>
</html>
