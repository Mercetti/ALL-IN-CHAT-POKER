<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome | All-In Chat Poker</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="style-theme.css">
  <link rel="stylesheet" href="style-welcome.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6226206359050540" crossorigin="anonymous"></script>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="hero-nav-bar">
        <div class="brand-chip">All-In Chat Poker</div>
        <nav class="hero-nav" aria-label="Primary">
          <a class="nav-link" href="/obs-overlay.html" target="_blank" rel="noopener">Overlay</a>
          <a class="nav-link" href="/admin2.html" target="_blank" rel="noopener">Admin</a>
          <a class="nav-link" href="/setup.html" target="_blank" rel="noopener">Setup</a>
          <a class="nav-link" href="/overlay-editor.html" target="_blank" rel="noopener">Editor</a>
          <a class="nav-link" href="/cosmetics.html" target="_blank" rel="noopener">Store</a>
          <a class="nav-link" href="/partner-program.html" target="_blank" rel="noopener">Partners</a>
          <a class="nav-link" href="/profile.html" target="_blank" rel="noopener">My Profile</a>
          <a class="nav-link ghost" href="https://www.paypal.com/donate/?hosted_button_id=STB7K4BTREWDC" target="_blank" rel="noopener">Support</a>
        </nav>
      </div>
      <h1>Bring Twitch Chat to the Table</h1>
      <p class="lede">
        Spin up live Blackjack and Video Poker rounds where viewers join with <code>!join</code> or place bets right from chat. Drop the overlay into OBS, start rounds from the admin panel, and let the hype take over.
      </p>
      <div class="pill status-pill">Status: Alpha testing (multi-stream lobbies + avatars)</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Why it's fun</h2>
        <ul>
          <li>Chat becomes the table: viewers jump in with one command.</li>
          <li>Bold OBS overlay with avatars, seating, and live pot glow.</li>
          <li>Blackjack and poker flows you control from one panel.</li>
          <li>Poker is for multi-stream lobbies only; see the <a href="/poker-rules.html">poker rules</a>.</li>
          <li>Texas Hold'em details: <a href="/holdem-rules.html">Hold'em rules</a>.</li>
        </ul>
      </div>

      <div class="card">
        <h2>Quick start</h2>
        <ul>
          <li>OBS: copy your channel-scoped Browser Source from your Profile page.</li>
          <li>Auto-join: when the streamer logs in, their channel is added for the bot.</li>
          <li>Blackjack rules: see <a href="/blackjack-rules.html">/blackjack-rules.html</a>.</li>
        </ul>
      </div>

      <div class="card">
        <h2>Support the table</h2>
        <p class="muted">If you're vibing with All-In Chat Poker (powered by allinchatpokerbot), toss a tip to keep the felt glowing.</p>
        <a class="btn" href="https://www.paypal.com/donate/?hosted_button_id=STB7K4BTREWDC" target="_blank" rel="noopener">Send a PayPal tip</a>
      </div>

    </div>

    <div class="card" style="margin-top:18px;">
      <h2>Vibes from the felt</h2>
      <p class="muted">Live assets the overlay already ships with: card backs, chip stacks, deal and win FX, plus the neon table frame.</p>
      <div class="gallery">
        <img src="/assets/cosmetics/cards/basic/card-back-purple.png" alt="Purple neon card back">
        <img src="/assets/cosmetics/effects/chips/chip-100-top.png" alt="Chip stack top view">
        <img src="/assets/cosmetics/effects/deals/face-down/horizontal_transparent_sheet.png" alt="Face-down deal animation sheet">
        <canvas class="sprite-preview-canvas" id="winburst-canvas" aria-label="Win burst sprite preview"></canvas>
        <div class="sprite-preview" id="allin-sprite-preview" aria-label="All-in burst sprite preview"></div>
        <div class="gallery-table-preview" aria-label="Neon table preview">
          <div class="table-center">All streamers vs allinchatpokerbot</div>
          <div class="table-cards">
            <span class="card-mini">A♠</span>
            <span class="card-mini">K♣</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card suggestion-card" style="margin-top:18px;">
      <h2>Suggestion box</h2>
      <p class="muted">Have an idea or spotted a bug? Send it straight to the team.</p>
      <div class="suggestion-form">
        <input id="suggestion-name" type="text" placeholder="Your name (optional)" class="form-control">
        <textarea id="suggestion-text" rows="3" placeholder="Share feedback, feature ideas, or issues..." class="form-control"></textarea>
        <button id="send-suggestion" class="btn">Email feedback</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const btn = document.getElementById('send-suggestion');
      if (!btn) return;
      btn.addEventListener('click', () => {
        const name = document.getElementById('suggestion-name')?.value.trim();
        const message = document.getElementById('suggestion-text')?.value.trim();
        if (!message) {
          alert('Please add a quick message before sending.');
          return;
        }
        const subject = encodeURIComponent('All-In Chat Poker suggestion');
        const bodyLines = [
          name ? 'From: ' + name : '',
          '',
          message
        ].filter(Boolean);
        const body = encodeURIComponent(bodyLines.join('\n'));
        window.location.href = 'mailto:allinchatpoker@gmail.com?subject=' + subject + '&body=' + body;
      });
    })();

    // Kick the sprite preview into an animated state and derive frame count from the sheet
    (function () {
      const preview = document.getElementById('allin-sprite-preview');
      if (!preview) return;
      const SPRITE_URL = '/assets/cosmetics/effects/all-in/allin_burst_horizontal_sheet.png?v=3';
      const img = new Image();
      img.onload = () => {
        if (!img.naturalHeight) return;
        const frames = Math.max(1, Math.round(img.naturalWidth / img.naturalHeight));
        preview.style.setProperty('--frames', frames);
        preview.style.backgroundImage = `url('${SPRITE_URL}')`;
        preview.setAttribute('aria-label', `All-in burst sprite preview (${frames} frames)`);
      };
      img.onerror = () => {
        preview.textContent = 'All-in animation preview unavailable';
      };
      img.src = SPRITE_URL;
      // Fallback while loading
      preview.style.backgroundImage = `url('${SPRITE_URL}')`;
      preview.style.setProperty('--frames', 6);
    })();

    // Animate the win burst sprite (24-frame horizontal sheet)
    (function () {
      const canvas = document.getElementById('winburst-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const SPRITE_URL = '/assets/cosmetics/effects/win/AllInChatPoker_Glitch_24Frames_1024x1024_Horizontal_FIXED.png';
      const meta = { columns: 24, rows: 1, frameCount: 24, fps: 18, frameWidth: 1024, frameHeight: 1024 };
      canvas.width = 256;
      canvas.height = 180;
      const img = new Image();
      img.onload = () => {
        const cols = Math.max(1, meta.columns || Math.floor(img.naturalWidth / (meta.frameWidth || img.naturalWidth)));
        const rows = Math.max(1, meta.rows || Math.ceil((meta.frameCount || cols) / cols));
        const frames = meta.frameCount || cols * rows;
        const fw = meta.frameWidth || Math.floor(img.naturalWidth / cols);
        const fh = meta.frameHeight || Math.floor(img.naturalHeight / rows);
        let frame = 0;
        console.debug('[winburst] loaded', { w: img.naturalWidth, h: img.naturalHeight, fw, fh, cols, rows, frames });
        const draw = () => {
          if (!canvas.isConnected) return;
          const f = frame % frames;
          const col = f % cols;
          const row = Math.floor(f / cols);
          const sx = col * fw;
          const sy = row * fh;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, sx, sy, fw, fh, 0, 0, canvas.width, canvas.height);
          frame += 1;
          setTimeout(() => requestAnimationFrame(draw), Math.max(20, 1000 / (meta.fps || 24)));
        };
        draw();
      };
      img.onerror = (e) => console.warn('[winburst] failed to load sprite', e);
      img.src = SPRITE_URL;
    })();

    // Ensure overlay link opens the signed-in streamer's channel
    (function () {
      const overlayLink = document.querySelector('a.nav-link[href="/obs-overlay.html"]');
      if (!overlayLink) return;
      const decodeLogin = (tok) => {
        if (!tok || typeof tok !== 'string') return '';
        try {
          const payload = tok.split('.')[1];
          const pad = payload.length % 4 === 2 ? '==' : payload.length % 4 === 3 ? '=' : '';
          const data = JSON.parse(atob(payload.replace(/-/g, '+').replace(/_/g, '/') + pad));
          return (data.user || data.login || '').toLowerCase();
        } catch {
          return '';
        }
      };
      const tok = (localStorage.getItem && localStorage.getItem('user_jwt')) || '';
      const login = decodeLogin(tok);
      if (login) {
        overlayLink.href = `/obs-overlay.html?channel=${encodeURIComponent(login)}`;
      }
    })();
  </script>
</body>
</html>
