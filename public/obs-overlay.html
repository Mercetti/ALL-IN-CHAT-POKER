<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OBS Table Overlay | All-In Chat Poker</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="preconnect" href="https://cdn.socket.io" crossorigin>
  <link rel="stylesheet" href="style-theme.css">
  <link rel="stylesheet" href="style-obs-overlay.css">
  <link rel="stylesheet" href="accessibility.css">
  <link rel="stylesheet" href="/acey/styles.css">
</head>
<body class="obs-body">
  <div class="overlay-container" id="overlay-container">
    <div class="meta-row">
      <span class="status-pill" id="connection-pill">Connecting...</span>
      <span class="status-pill" id="seated-pill">0 / 8 seated</span>
      <span class="status-pill" id="mode-pill">Mode: -</span>
      <span class="status-pill" id="channel-pill">Channel: -</span>
      <button class="settings-button" id="settings-button">‚öôÔ∏è</button>
    </div>

    <div class="table-frame">
      <div class="table-surface">
        <div class="table-brand">
          <span>All-In</span>
          <span>Chat</span>
          <span>Poker</span>
        </div>
      </div>

      <div class="seat-layer">
        <div class="seat" data-seat="0">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="1">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="2">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="3">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="4">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="5">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="6">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
        <div class="seat" data-seat="7">
          <div class="avatar-wrap">
            <img src="/assets/overlay/open-seat.svg" alt="Open seat" onerror="this.src='/logo.png'">
          </div>
          <div class="seat-name">Open Seat</div>
        </div>
      </div>
      <div class="table-stats">
        <div class="table-stat">
          <div class="table-stat-heading">
            <span class="table-stat-icon">üéØ</span>
            <span class="table-stat-label">Phase</span>
          </div>
          <span class="table-stat-value" id="phase-label">Waiting</span>
        </div>
        <div class="table-stat">
          <div class="table-stat-heading">
            <span class="table-stat-icon">‚è±Ô∏è</span>
            <span class="table-stat-label">Timer</span>
          </div>
          <span class="table-stat-value" id="timer-badge">00:00</span>
        </div>
        <div class="table-stat">
          <div class="table-stat-heading">
            <span class="table-stat-icon">üí∞</span>
            <span class="table-stat-label">Total Pot</span>
          </div>
          <span class="table-stat-value pot-amount" id="table-pot-value">$0</span>
        </div>
        <div class="table-stat">
          <div class="table-stat-heading">
            <span class="table-stat-icon">ü™ë</span>
            <span class="table-stat-label">Queue</span>
          </div>
          <span class="table-stat-value">
            <span id="waiting-count">0</span>
            <span class="queue-names" id="waiting-names">None</span>
          </span>
          <div class="queue-chip-row" id="queue-chip-row">
            <span class="queue-chip queue-chip-empty">Queue is open</span>
          </div>
        </div>
      </div>
    </div>

    <div class="overflow-row" id="overflow-row">
      <span class="label">Waiting</span>
      <span class="names" id="overflow-names">-</span>
    </div>

    <!-- Chat Overlay Integration -->
    <div class="chat-overlay" id="chat-overlay">
      <div class="chat-header">
        <span class="chat-title">Live Chat</span>
        <button class="chat-toggle" id="chat-toggle">√ó</button>
      </div>
      <div class="chat-messages" id="chat-messages"></div>
      <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Type message..." />
        <button id="chat-send">Send</button>
      </div>
    </div>

    <!-- Overlay Branding -->
    <div class="brand-logo" id="brand-logo">
      <img src="/assets/overlay/brand-logo.png" alt="All-In Chat Poker" />
    </div>
    <div class="brand-name" id="brand-name">All-In Chat Poker</div>

    <!-- Overlay Statistics -->
    <div class="stats-overlay" id="stats-overlay">
      <div class="stats-header">
        <span class="stats-title">Game Statistics</span>
        <button class="stats-toggle" id="stats-toggle">√ó</button>
      </div>
      <div class="stats-content">
        <div class="hands-played" id="hands-played">Hands: 0</div>
        <div class="win-rate" id="win-rate">Win Rate: 0%</div>
        <div class="avg-pot" id="avg-pot">Avg Pot: $0</div>
      </div>
    </div>

    <!-- Overlay Animations -->
    <div class="card-deal-animation" id="card-deal-animation">
      <div class="card-animation-content">
        <div class="dealing-cards">üé¥</div>
      </div>
    </div>
    <div class="bet-animation" id="bet-animation">
      <div class="bet-animation-content">
        <div class="betting-chips">ü™ô</div>
      </div>
    </div>
    <div class="chip-animation" id="chip-animation">
      <div class="chip-animation-content">
        <div class="moving-chips">ü™ô</div>
      </div>
    </div>
    <div class="win-animation" id="win-animation">
      <div class="win-animation-content">
        <div class="win-text">WINNER!</div>
        <div class="win-effects">üéâ</div>
      </div>
    </div>

    <!-- Community Cards Area -->
    <div class="community-cards" id="community-cards">
      <div class="community-cards-container">
        <div class="community-card" id="flop1"></div>
        <div class="community-card" id="flop2"></div>
        <div class="community-card" id="flop3"></div>
        <div class="community-card" id="turn"></div>
        <div class="community-card" id="river"></div>
      </div>
    </div>

    <!-- Winner Announcement -->
    <div class="winner-announcement" id="winner-announcement">
      <div class="winner-content">
        <div class="winner-header">
          <span class="winner-label">WINNER!</span>
        </div>
        <div class="winner-details">
          <span class="winner-name" id="winner-name">Player Name</span>
          <span class="winning-hand" id="winning-hand">Hand Type</span>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay-screen" id="overlay-loading">
    <div class="screen-card">
      <div class="screen-spinner"></div>
      <h2>Spinning up the table‚Ä¶</h2>
      <p>We‚Äôre syncing seats, cosmetics, and FX for your overlay.</p>
    </div>
  </div>

  <div class="overlay-screen hidden" id="overlay-error">
    <div class="screen-card error connection-error">
      <div class="screen-icon">‚ö†Ô∏è</div>
      <h2>Overlay connection failed</h2>
      <p>We couldn't connect to the table feed. Check your auth token or network and try again.</p>
      <button class="screen-btn" id="overlay-retry">Retry Connection</button>
      <div class="reconnecting hidden">Reconnecting...</div>
    </div>
  </div>

  <div id="aceyOverlay" class="acey-overlay" aria-live="polite">
    <div class="acey-primary">
      <span class="acey-name">Acey</span>
      <span class="acey-text">Booting dealer personality‚Ä¶</span>
    </div>
    <div class="acey-alerts">
      <div id="peakEvent" class="overlay-peak" aria-live="polite"></div>
      <div id="periodicSummary" class="overlay-summary" aria-live="polite"></div>
    </div>
  </div>

  <!-- Overlay Settings Panel -->
    <div class="overlay-settings hidden" id="overlay-settings">
      <div class="settings-panel">
        <h3>Overlay Settings</h3>
        <div class="setting-group">
          <label>Theme:</label>
          <select id="theme-select">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>
        <div class="setting-group">
          <label>Opacity:</label>
          <input type="range" id="opacity-slider" min="0" max="1" step="0.1" value="0.9" />
        </div>
        <div class="setting-actions">
          <button id="save-settings">Save Settings</button>
          <button id="reset-settings" class="reset-btn">Reset to Default</button>
        </div>
      </div>
    </div>

  <div id="toast-container" class="toast-container"></div>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" defer></script>
  <script src="client.js" defer></script>
  <script src="accessibility.js" defer></script>
  <script src="/js/auth-utils.js" defer></script>
  <script src="js/overlay-error-boundary.js" defer></script>
  <script src="js/poker-keyboard-navigation.js" defer></script>
  <script src="js/poker-mobile-responsive.js" defer></script>
  <script src="js/poker-websocket-manager.js" defer></script>
  <script src="js/poker-realtime-updates.js" defer></script>
  <script src="js/poker-game-ui.js" defer></script>
  <script src="js/poker-design-system.js" defer></script>
  <script src="js/poker-loading-states.js" defer></script>
  <script src="js/poker-game-components.js" defer></script>
  <script src="js/consistent-color-scheme.js" defer></script>
  <script src="js/poker-game-animations.js" defer></script>
  <script src="js/secure-token-storage.js" defer></script>
  <script src="js/safe-dom-utils.js" defer></script>
  <script src="js/standardized-event-handler.js" defer></script>
  <script src="js/standardized-fetch-handler.js" defer></script>
  <script src="js/console-log-remover.js" defer></script>
  <script src="js/safe-eval-replacer.js" defer></script>
  <script src="js/input-validator.js" defer></script>
  <script src="js/content-security-policy.js" defer></script>
  <script src="js/rate-limiter.js" defer></script>
  <script src="js/bundle-size-optimizer.js" defer></script>
  <script src="js/code-documentation-generator.js" defer></script>
  <script src="js/code-formatter.js" defer></script>
  <script src="js/security-guidelines-documentation.js" defer></script>
  <script>
    // Note: Authentication disabled for overlay - should be publicly accessible for streaming
    // enforceAuthenticatedPage({ page: 'overlay' });
  </script>
  <script type="module" src="overlay.js"></script>
  <script>
    window.AceyConfig = Object.assign({}, window.AceyConfig || {}, {
      sessionId: window.currentChannel || 'default',
      userId: (window.currentUser && window.currentUser.login) || 'viewer',
      userEmail: (window.currentUser && window.currentUser.email) || '',
      isUltra: Boolean(window.currentUser && window.currentUser.isUltra)
    });
  </script>
  
  <!-- Chat Message Handler for Tests -->
  <script>
    // Listen for chat messages and add them to the chat overlay
    window.addEventListener('chatMessage', (event) => {
      console.log('chatMessage event received:', event.detail);
      const { user, message } = event.detail;
      const chatMessages = document.getElementById('chat-messages');
      if (chatMessages) {
        const messageElement = document.createElement('div');
        messageElement.innerHTML = `<strong>${user}:</strong> ${message}`;
        chatMessages.appendChild(messageElement);
        console.log('Message added to chat:', messageElement.innerHTML);
      } else {
        console.error('chat-messages element not found');
      }
    });
    
    // Also add a global function for debugging
    window.addTestMessage = (user, message) => {
      const chatMessages = document.getElementById('chat-messages');
      if (chatMessages) {
        const messageElement = document.createElement('div');
        messageElement.innerHTML = `<strong>${user}:</strong> ${message}`;
        chatMessages.appendChild(messageElement);
      }
    };
  </script>
  
  <script type="module" src="/acey/aceyUI.js"></script>
</body>
</html>
