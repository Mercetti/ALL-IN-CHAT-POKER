<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Helm Enhanced Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden; /* Prevent body from scrolling */
        }
        
        html {
            overflow: hidden; /* Also prevent html scrollbar */
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        
        .status-item {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #3a3a5e;
            border-radius: 8px;
            padding: 10px 20px;
            text-align: center;
        }
        
        .chat-section {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid #3a3a5e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            height: 85vh; /* Take up most of the page */
            min-height: 700px;
            max-height: 90vh; /* Prevent from taking too much space */
            overflow: hidden; /* Prevent section from scrolling */
        }
        
        /* Chat Message Bubbles */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(26, 26, 46, 0.5);
            border-radius: 12px;
            border: 1px solid #3a3a5e;
            margin-bottom: 15px;
            overflow-x: hidden; /* Prevent horizontal scrollbar */
            min-height: 0; /* Allow flexbox to work properly */
            /* Custom scrollbar styling */
            scrollbar-width: thin;
            scrollbar-color: #667eea #2a2a3e;
        }
        
        /* Custom scrollbar for Webkit browsers */
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: #2a2a3e;
            border-radius: 4px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
        
        .message-bubble {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s ease-in;
        }
        
        .message-bubble.user {
            justify-content: flex-end;
        }
        
        .message-bubble.assistant {
            justify-content: flex-start;
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
        }
        
        .message-bubble.user .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message-bubble.assistant .message-content {
            background: rgba(58, 58, 94, 0.8);
            color: #e0e0e0;
            border-bottom-left-radius: 4px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 4px;
            opacity: 0.7;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin: 0 8px;
        }
        
        .message-bubble.user .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            order: 1;
        }
        
        .message-bubble.assistant .message-avatar {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.5);
        }
        
        .chat-input-container {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 12px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 12px;
            border: 1px solid #3a3a5e;
            flex-shrink: 0; /* Prevent input container from growing */
            margin-top: 0; /* Remove any extra margin */
        }
        
        .upload-button {
            padding: 8px 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .upload-button:hover {
            background: linear-gradient(135deg, #764ba2, #667eea);
            transform: translateY(-1px);
        }
        
        .upload-button:active {
            transform: translateY(0);
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(58, 58, 94, 0.6);
            border: 1px solid #3a3a5e;
            border-radius: 25px;
            color: #e0e0e0;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        /* File Upload Styles */
        .file-upload-section {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid #3a3a5e;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .file-upload-area {
            border: 2px dashed #3a3a5e;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(58, 58, 94, 0.2);
        }
        
        .file-upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .file-upload-area.dragging {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }
        
        .file-upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: #667eea;
        }
        
        .file-upload-text {
            color: #e0e0e0;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .file-upload-hint {
            color: #9ca3af;
            font-size: 12px;
        }
        
        .file-input {
            display: none;
        }
        
        .uploaded-files {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .uploaded-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(58, 58, 94, 0.4);
            border: 1px solid #3a3a5e;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 8px;
            animation: fadeIn 0.3s ease-in;
        }
        
        .uploaded-file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .uploaded-file-icon {
            font-size: 16px;
        }
        
        .uploaded-file-details {
            flex: 1;
        }
        
        .uploaded-file-name {
            color: #e0e0e0;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .uploaded-file-size {
            color: #9ca3af;
            font-size: 10px;
        }
        
        .uploaded-file-preview {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            object-fit: cover;
            border: 1px solid #3a3a5e;
        }
        
        .remove-file-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .remove-file-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }
        
        /* File Upload Modal */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .upload-modal-content {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid #3a3a5e;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .upload-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .upload-modal-title {
            color: #e0e0e0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-modal-btn {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .close-modal-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .chat-input:focus {
            border-color: #667eea;
            background: rgba(58, 58, 94, 0.8);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .chat-input::placeholder {
            color: #9ca3af;
        }
        
        .model-select {
            padding: 6px 10px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #3a3a5e;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 12px;
            min-width: 100px;
            flex-shrink: 0;
        }
        
        .chat-send-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            flex-shrink: 0;
        }
        
        .chat-send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 12px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            animation: pulse 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        .logo-display {
            margin-top: 20px;
            text-align: center;
        }
        
        .logo-display canvas {
            border: 2px solid #3a3a5e;
            border-radius: 8px;
            background: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const EnhancedHelmChat = () => {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [selectedModel, setSelectedModel] = useState('phi');
            const [isLoading, setIsLoading] = useState(false);
            const [helmStatus, setHelmStatus] = useState({ running: false });
            const [pendingAssets, setPendingAssets] = useState([]);
            const [uploadedFiles, setUploadedFiles] = useState([]);
            const [isDragging, setIsDragging] = useState(false);
            const [showUploadModal, setShowUploadModal] = useState(false);
            
            const availableModels = ['tinyllama', 'phi', 'qwen:0.5b', 'deepseek-coder:1.3b'];
            
            // Smart model selection based on prompt content
            const selectBestModel = (prompt) => {
                const lowerPrompt = prompt.toLowerCase();
                
                if (lowerPrompt.includes('code') || lowerPrompt.includes('analyze') || lowerPrompt.includes('debug')) {
                    return 'deepseek-coder:1.3b';
                } else if (lowerPrompt.includes('create') || lowerPrompt.includes('logo') || lowerPrompt.includes('design')) {
                    return 'phi';
                } else if (lowerPrompt.includes('quick') || lowerPrompt.includes('help')) {
                    return 'tinyllama';
                } else {
                    return 'phi'; // default balanced model
                }
            };
            
            // Auto-select model when input changes
            useEffect(() => {
                if (input.length > 10) {
                    const bestModel = selectBestModel(input);
                    setSelectedModel(bestModel);
                }
            }, [input]);
            
            useEffect(() => {
                checkHelmStatus();
            }, []);
            
            const checkHelmStatus = async () => {
                try {
                    const response = await fetch('http://localhost:3001/helm/status');
                    const data = await response.json();
                    setHelmStatus(data);
                } catch (error) {
                    console.log('Helm not connected');
                }
            };
            
            const sendMessage = async () => {
                if (!input.trim()) return;
                
                const userMessage = {
                    content: input,
                    isUser: true,
                    timestamp: new Date().toISOString()
                };
                
                setMessages(prev => [...prev, userMessage]);
                setIsLoading(true);
                
                // Advanced AI-powered detection system
                const lowerInput = input.toLowerCase();
                const words = lowerInput.split(/\s+/);
                
                // Sophisticated intent detection
                const detectIntent = (text) => {
                    const creationVerbs = ['create', 'make', 'design', 'generate', 'draw', 'craft', 'build', 'produce', 'develop', 'render', 'illustrate', 'craft', 'form', 'construct', 'produce', 'make me', 'give me', 'i need', 'i want', 'can you', 'could you'];
                    const visualNouns = ['logo', 'icon', 'image', 'picture', 'graphic', 'art', 'design', 'visual', 'emblem', 'symbol', 'badge', 'insignia', 'mark', 'brand', 'avatar', 'portrait', 'illustration', 'emote', 'emoji', 'face', 'smiley', 'sticker'];
                    const audioNouns = ['sound', 'audio', 'music', 'track', 'beat', 'melody', 'tune', 'effect', 'sfx', 'noise', 'clip', 'recording'];
                    const pokerTerms = ['poker', 'card', 'chip', 'table', 'felt', 'suit', 'spade', 'heart', 'diamond', 'club', 'deck', 'dealer', 'player', 'casino'];
                    
                    // Check for creation intent
                    const hasCreationVerb = creationVerbs.some(verb => text.includes(verb));
                    
                    // Check for visual asset intent
                    const hasVisualNoun = visualNouns.some(noun => text.includes(noun));
                    
                    // Check for audio asset intent
                    const hasAudioNoun = audioNouns.some(noun => text.includes(noun));
                    
                    // Check for poker-specific context
                    const hasPokerContext = pokerTerms.some(term => text.includes(term));
                    
                    // Advanced pattern matching
                    const patterns = {
                        // Logo patterns
                        logo: [
                            /\b(create|make|design|generate|draw).+logo\b/,
                            /\blogo.+for\b/,
                            /\bneed.+logo\b/,
                            /\blogo.+design\b/,
                            /\bbrand.+logo\b/,
                            /\bcompany.+logo\b/,
                            /\blogo.+represent\b/,
                            /\blogo.+symboliz\b/,
                            /\bemblem.+for\b/,
                            /\bsymbol.+for\b/
                        ],
                        // Emote patterns
                        emote: [
                            /\b(create|make|design).+emote\b/,
                            /\b(create|make|design).+emoji\b/,
                            /\b(create|make|design).+face\b/,
                            /\b(create|make|design).+smiley\b/,
                            /\bemote.+express\b/,
                            /\bemoji.+show\b/,
                            /\bface.+show\b/
                        ],
                        // Audio patterns
                        audio: [
                            /\b(create|make|design|generate).+sound\b/,
                            /\b(create|make|design|generate).+audio\b/,
                            /\b(create|make|design|generate).+music\b/,
                            /\b(create|make|design|generate).+effect\b/,
                            /\bsound.+effect\b/,
                            /\baudio.+clip\b/,
                            /\bbackground.+music\b/,
                            /\bbgm\b/,
                            /\bsfx\b/
                        ],
                        // Poker asset patterns
                        poker: [
                            /\b(create|make|design).+card.+back\b/,
                            /\b(create|make|design).+playing.+card\b/,
                            /\b(create|make|design).+poker.+chip\b/,
                            /\b(create|make|design).+poker.+table\b/,
                            /\b(create|make|design).+card.+suit\b/,
                            /\b(create|make|design).+poker.+avatar\b/,
                            /\bcard.+back\b/,
                            /\bpoker.+chip\b/,
                            /\btable.+felt\b/
                        ]
                    };
                    
                    // Test patterns
                    const matchedPatterns = {};
                    Object.keys(patterns).forEach(type => {
                        matchedPatterns[type] = patterns[type].some(pattern => pattern.test(text));
                    });
                    
                    // Determine intent with confidence scoring
                    const intent = {
                        logo: {
                            score: 0,
                            detected: false
                        },
                        emote: {
                            score: 0,
                            detected: false
                        },
                        audio: {
                            score: 0,
                            detected: false
                        },
                        poker: {
                            score: 0,
                            detected: false
                        }
                    };
                    
                    // Score calculation
                    if (hasCreationVerb) {
                        if (hasVisualNoun) {
                            if (text.includes('logo') || matchedPatterns.logo) {
                                intent.logo.score += 10;
                                intent.logo.detected = true;
                            }
                            if (text.includes('emote') || text.includes('emoji') || text.includes('face') || matchedPatterns.emote) {
                                intent.emote.score += 10;
                                intent.emote.detected = true;
                            }
                        }
                        if (hasAudioNoun || matchedPatterns.audio) {
                            intent.audio.score += 10;
                            intent.audio.detected = true;
                        }
                        if (hasPokerContext || matchedPatterns.poker) {
                            intent.poker.score += 8;
                            intent.poker.detected = true;
                        }
                    }
                    
                    // Contextual scoring
                    if (text.includes('helm') && (hasVisualNoun || hasCreationVerb)) {
                        intent.logo.score += 5;
                    }
                    
                    if (text.includes('represent') && hasVisualNoun) {
                        intent.logo.score += 3;
                    }
                    
                    if (text.includes('ai') && hasVisualNoun) {
                        intent.logo.score += 3;
                    }
                    
                    // Determine highest scoring intent
                    let highestIntent = null;
                    let highestScore = 0;
                    
                    Object.keys(intent).forEach(type => {
                        if (intent[type].score > highestScore) {
                            highestScore = intent[type].score;
                            highestIntent = type;
                        }
                    });
                    
                    return {
                        intent: highestIntent,
                        confidence: highestScore,
                        details: intent,
                        isAssetRequest: highestScore > 5
                    };
                };
                
                const detection = detectIntent(lowerInput);
                
                // If it's an asset creation request, handle it locally and skip backend
                if (detection.isAssetRequest) {
                    console.log('üéØ AI Detection:', {
                        intent: detection.intent,
                        confidence: detection.confidence,
                        input: input
                    });
                    
                    // Handle different asset types based on detected intent
                    if (detection.intent === 'logo' || detection.intent === 'emote' || detection.intent === 'poker') {
                        setTimeout(() => createLogo(input), 500);
                    } else if (detection.intent === 'audio') {
                        setTimeout(() => createAudio(input), 500);
                    }
                    
                    setIsLoading(false);
                    setInput('');
                    return;
                }
                
                // For non-asset requests, try to call the backend
                try {
                    const response = await fetch('http://localhost:3000/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: input,
                            model: selectedModel
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    const aiMessage = {
                        content: result.result?.response || result.result || 'Response received',
                        isUser: false,
                        timestamp: new Date().toISOString()
                    };
                    
                    setMessages(prev => [...prev, aiMessage]);
                    
                } catch (error) {
                    // Check if it's an asset creation request first, before showing error
                    const lowerInput = input.toLowerCase();
                    if (lowerInput.includes('create logo') || lowerInput.includes('make a logo') || 
                        lowerInput.includes('design a logo') || lowerInput.includes('generate logo') ||
                        lowerInput.includes('create icon') || lowerInput.includes('make an icon') ||
                        lowerInput.includes('create image') || lowerInput.includes('make an image') ||
                        lowerInput.includes('create emote') || lowerInput.includes('make an emote') || 
                        lowerInput.includes('create emoji') || lowerInput.includes('make an emoji') ||
                        lowerInput.includes('emote') || lowerInput.includes('emoji') ||
                        lowerInput.includes('card back') || lowerInput.includes('playing card') ||
                        lowerInput.includes('poker chip') || lowerInput.includes('chip') && lowerInput.includes('poker') ||
                        lowerInput.includes('avatar') && lowerInput.includes('poker') ||
                        lowerInput.includes('table') && (lowerInput.includes('poker') || lowerInput.includes('felt')) ||
                        lowerInput.includes('suit') && (lowerInput.includes('card') || lowerInput.includes('spade') || lowerInput.includes('heart') || lowerInput.includes('diamond') || lowerInput.includes('club'))) {
                        setTimeout(() => createLogo(input), 500);
                    } else if (lowerInput.includes('create sound') || lowerInput.includes('make a sound') || lowerInput.includes('generate sound') ||
                        lowerInput.includes('create audio') || lowerInput.includes('make audio') || lowerInput.includes('generate audio') ||
                        lowerInput.includes('create music') || lowerInput.includes('make music') || lowerInput.includes('generate music') ||
                        lowerInput.includes('create shuffle sound') || lowerInput.includes('make shuffle sound') ||
                        lowerInput.includes('create chip sound') || lowerInput.includes('make chip sound') ||
                        lowerInput.includes('create win sound') || lowerInput.includes('make win sound') ||
                        lowerInput.includes('create lose sound') || lowerInput.includes('make lose sound') ||
                        lowerInput.includes('create deal sound') || lowerInput.includes('make deal sound') ||
                        lowerInput.includes('create bet sound') || lowerInput.includes('make bet sound') ||
                        lowerInput.includes('create background music') || lowerInput.includes('make background music') ||
                        lowerInput.includes('create alert sound') || lowerInput.includes('make alert sound')) {
                        setTimeout(() => createAudio(input), 500);
                    } else {
                        const errorMessage = {
                            content: 'Sorry, I encountered an error. Please make sure Helm server is running.',
                            isUser: false,
                            timestamp: new Date().toISOString()
                        };
                        setMessages(prev => [...prev, errorMessage]);
                    }
                }
                
                setIsLoading(false);
            };
            
            const createLogo = (description) => {
                const canvas = document.getElementById('logo-canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                const width = 200;
                const height = 200;

                canvas.width = width;
                canvas.height = height;

                const lowerDesc = description.toLowerCase();

                // Create graphics based on description - only create poker graphics if explicitly requested
                if (lowerDesc.includes('emote') || lowerDesc.includes('emoji')) {
                    createEmote(ctx, width, height, description);
                } else if (lowerDesc.includes('card back') || lowerDesc.includes('playing card')) {
                    createCardBack(ctx, width, height);
                } else if (lowerDesc.includes('poker chip') || (lowerDesc.includes('chip') && lowerDesc.includes('poker'))) {
                    createPokerChip(ctx, width, height);
                } else if (lowerDesc.includes('avatar') && lowerDesc.includes('poker')) {
                    createPlayerAvatar(ctx, width, height);
                } else if (lowerDesc.includes('table') && (lowerDesc.includes('poker') || lowerDesc.includes('felt'))) {
                    createTableFelt(ctx, width, height);
                } else if (lowerDesc.includes('suit') && (lowerDesc.includes('card') || lowerDesc.includes('spade') || lowerDesc.includes('heart') || lowerDesc.includes('diamond') || lowerDesc.includes('club'))) {
                    createCardSuit(ctx, width, height, lowerDesc);
                } else if (lowerDesc.includes('poker') || lowerDesc.includes('casino')) {
                    createPokerLogo(ctx, width, height);
                } else {
                    createGeneralLogo(ctx, width, height, description); // Create general logo
                }
                
                // Convert canvas to image data URL
                const imageData = canvas.toDataURL('image/png');
                
                // Show the canvas
                canvas.style.display = 'block';
                
                // Create pending asset for approval
                const pendingAsset = {
                    id: Date.now(),
                    type: 'image',
                    assetType: getAssetType(lowerDesc),
                    description: description,
                    imageUrl: imageData,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                setPendingAssets(prev => [...prev, pendingAsset]);
                
                // Add approval message
                const approvalMessage = {
                    content: `Poker ${getAssetType(lowerDesc)} created! Review and approve to implement:`,
                    isUser: false,
                    timestamp: new Date().toISOString(),
                    isApproval: true,
                    assetId: pendingAsset.id,
                    imageUrl: imageData
                };
                
                setMessages(prev => [...prev, approvalMessage]);
            };
            
            const getAssetType = (desc) => {
                if (desc.includes('card back')) return 'Card Back';
                if (desc.includes('poker chip') || desc.includes('chip') && desc.includes('poker')) return 'Poker Chip';
                if (desc.includes('avatar') && desc.includes('poker')) return 'Poker Avatar';
                if (desc.includes('table') && (desc.includes('poker') || desc.includes('felt'))) return 'Poker Table';
                if (desc.includes('suit') && (desc.includes('card') || desc.includes('spade') || desc.includes('heart') || desc.includes('diamond') || desc.includes('club'))) return 'Card Suit';
                if (desc.includes('emote') || desc.includes('emoji')) return 'Emote';
                if (desc.includes('logo')) return 'Logo';
                if (desc.includes('icon')) return 'Icon';
                if (desc.includes('image')) return 'Image';
                return 'Asset';
            };
            
            const createCardBack = (ctx, width, height) => {
                // Card back design
                const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
                gradient.addColorStop(0, '#2c3e50');
                gradient.addColorStop(0.5, '#34495e');
                gradient.addColorStop(1, '#2c3e50');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Add pattern
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(10, 10, width-20, height-20);
                
                // Inner border
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 1;
                ctx.setLineDash([]);
                ctx.strokeRect(20, 20, width-40, height-40);
                
                // Center design
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(width/2, height/2, 30, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ô†Ô∏è', width/2, height/2 + 5);
            };
            
            const createPokerChip = (ctx, width, height) => {
                // Poker chip design
                const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
                gradient.addColorStop(0, '#e74c3c');
                gradient.addColorStop(0.7, '#c0392b');
                gradient.addColorStop(1, '#8b0000');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(width/2, height/2, width/2 - 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Inner circle
                ctx.fillStyle = '#2c3e50';
                ctx.beginPath();
                ctx.arc(width/2, height/2, width/2 - 25, 0, Math.PI * 2);
                ctx.fill();
                
                // Dollar sign
                ctx.fillStyle = '#f39c12';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('$', width/2, height/2 + 8);
                
                // Edge dots
                ctx.fillStyle = '#f39c12';
                for (let i = 0; i < 8; i++) {
                    const angle = (i * Math.PI * 2) / 8;
                    const x = width/2 + Math.cos(angle) * (width/2 - 15);
                    const y = height/2 + Math.sin(angle) * (width/2 - 15);
                    ctx.beginPath();
                    ctx.arc(x, y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            };
            
            const createPlayerAvatar = (ctx, width, height) => {
                // Player avatar background
                const gradient = ctx.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Avatar circle
                ctx.fillStyle = '#f0f0f0';
                ctx.beginPath();
                ctx.arc(width/2, height/2, 60, 0, Math.PI * 2);
                ctx.fill();
                
                // Player icon
                ctx.fillStyle = '#333';
                ctx.font = 'bold 40px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üë§', width/2, height/2 + 10);
                
                // Status indicator
                ctx.fillStyle = '#10b981';
                ctx.beginPath();
                ctx.arc(width - 30, 30, 8, 0, Math.PI * 2);
                ctx.fill();
            };
            
            const createTableFelt = (ctx, width, height) => {
                // Poker table felt
                const gradient = ctx.createLinearGradient(0, 0, 0, height);
                gradient.addColorStop(0, '#0d5f2b');
                gradient.addColorStop(0.5, '#0a4f2a');
                gradient.addColorStop(1, '#0d5f2b');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Wood texture lines
                ctx.strokeStyle = '#084420';
                ctx.lineWidth = 1;
                for (let i = 0; i < height; i += 10) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(width, i);
                    ctx.stroke();
                }
                
                // Center design
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 3;
                ctx.strokeRect(width/2 - 40, height/2 - 40, 80, 80);
            };
            
            const createCardSuit = (ctx, width, height, desc) => {
                let suit = '‚ô†Ô∏è';
                let color = '#000000';
                
                if (desc.includes('heart') || desc.includes('‚ô•')) {
                    suit = '‚ô•Ô∏è';
                    color = '#e74c3c';
                } else if (desc.includes('diamond') || desc.includes('‚ô¶')) {
                    suit = '‚ô¶Ô∏è';
                    color = '#e74c3c';
                } else if (desc.includes('club') || desc.includes('‚ô£')) {
                    suit = '‚ô£Ô∏è';
                    color = '#000000';
                }
                
                // Card background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, width, height);
                
                // Card border
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = 2;
                ctx.strokeRect(5, 5, width-10, height-10);
                
                // Suit symbol
                ctx.fillStyle = color;
                ctx.font = 'bold 60px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(suit, width/2, height/2 + 20);
            };
            
            const createEmote = (ctx, width, height, description) => {
                const lowerDesc = description.toLowerCase();
                
                // Background
                const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
                gradient.addColorStop(0, '#ffd700');
                gradient.addColorStop(1, '#ffb347');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Face circle
                ctx.fillStyle = '#ffeb3b';
                ctx.beginPath();
                ctx.arc(width/2, height/2, 80, 0, Math.PI * 2);
                ctx.fill();
                
                // Face border
                ctx.strokeStyle = '#ff9800';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Eyes
                ctx.fillStyle = '#000000';
                
                if (lowerDesc.includes('happy') || lowerDesc.includes('smile') || lowerDesc.includes('joy')) {
                    // Happy eyes
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Smile
                    ctx.beginPath();
                    ctx.arc(width/2, height/2 + 10, 40, 0, Math.PI);
                    ctx.stroke();
                    
                } else if (lowerDesc.includes('wink') || lowerDesc.includes('winking')) {
                    // Winking face
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Winking eye
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 12, 0, Math.PI);
                    ctx.stroke();
                    
                    // Smile
                    ctx.beginPath();
                    ctx.arc(width/2, height/2 + 10, 40, 0, Math.PI);
                    ctx.stroke();
                    
                } else if (lowerDesc.includes('sad') || lowerDesc.includes('cry') || lowerDesc.includes('tear')) {
                    // Sad eyes
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Sad mouth
                    ctx.beginPath();
                    ctx.arc(width/2, height/2 + 40, 30, Math.PI, 0);
                    ctx.stroke();
                    
                    // Tear
                    ctx.fillStyle = '#4fc3f7';
                    ctx.beginPath();
                    ctx.arc(width/2 + 30, height/2 - 10, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                } else if (lowerDesc.includes('angry') || lowerDesc.includes('mad') || lowerDesc.includes('rage')) {
                    // Angry eyes
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Angry eyebrows
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(width/2 - 35, height/2 - 35);
                    ctx.lineTo(width/2 - 15, height/2 - 25);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(width/2 + 35, height/2 - 35);
                    ctx.lineTo(width/2 + 15, height/2 - 25);
                    ctx.stroke();
                    
                    // Angry mouth
                    ctx.beginPath();
                    ctx.moveTo(width/2 - 20, height/2 + 30);
                    ctx.lineTo(width/2 + 20, height/2 + 30);
                    ctx.stroke();
                    
                } else if (lowerDesc.includes('surprised') || lowerDesc.includes('shock') || lowerDesc.includes('wow')) {
                    // Surprised eyes
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 12, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 12, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Surprised mouth
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(width/2, height/2 + 25, 20, 0, Math.PI * 2);
                    ctx.fill();
                    
                } else if (lowerDesc.includes('cool') || lowerDesc.includes('sunglasses')) {
                    // Sunglasses
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(width/2 - 40, height/2 - 30, 30, 20);
                    ctx.fillRect(width/2 + 10, height/2 - 30, 30, 20);
                    ctx.fillRect(width/2 - 10, height/2 - 25, 20, 5);
                    
                    // Cool smile
                    ctx.beginPath();
                    ctx.moveTo(width/2 - 20, height/2 + 20);
                    ctx.quadraticCurveTo(width/2, height/2 + 30, width/2 + 20, height/2 + 20);
                    ctx.stroke();
                    
                } else if (lowerDesc.includes('love') || lowerDesc.includes('heart eyes')) {
                    // Heart eyes
                    ctx.fillStyle = '#e91e63';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('‚ù§Ô∏è', width/2 - 25, height/2 - 15);
                    ctx.fillText('‚ù§Ô∏è', width/2 + 25, height/2 - 15);
                    
                    // Love smile
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(width/2, height/2 + 10, 40, 0, Math.PI);
                    ctx.stroke();
                    
                } else if (lowerDesc.includes('thinking') || lowerDesc.includes('hmm') || lowerDesc.includes('ponder')) {
                    // Thinking eyes
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Looking to the side
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Thinking mouth
                    ctx.beginPath();
                    ctx.moveTo(width/2 - 15, height/2 + 25);
                    ctx.lineTo(width/2 + 5, height/2 + 25);
                    ctx.stroke();
                    
                    // Thought bubble
                    ctx.fillStyle = '#ffffff';
                    ctx.beginPath();
                    ctx.arc(width/2 + 60, height/2 - 40, 15, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 70, height/2 - 50, 10, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 75, height/2 - 55, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                } else {
                    // Default happy face
                    ctx.beginPath();
                    ctx.arc(width/2 - 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(width/2 + 25, height/2 - 20, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(width/2, height/2 + 10, 40, 0, Math.PI);
                    ctx.stroke();
                }
            };
            
            const createGeneralLogo = (ctx, width, height, description) => {
                // General logo design based on description
                const lowerDesc = description.toLowerCase();
                
                // Background gradient
                const gradient = ctx.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // White background circle
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.beginPath();
                ctx.arc(width/2, height/2, 70, 0, Math.PI * 2);
                ctx.fill();
                
                // Icon based on description
                ctx.fillStyle = '#667eea';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (lowerDesc.includes('helm') || lowerDesc.includes('shield')) {
                    ctx.fillText('üõ°Ô∏è', width/2, height/2);
                } else if (lowerDesc.includes('tech') || lowerDesc.includes('code')) {
                    ctx.fillText('üíª', width/2, height/2);
                } else if (lowerDesc.includes('star') || lowerDesc.includes('rating')) {
                    ctx.fillText('‚≠ê', width/2, height/2);
                } else if (lowerDesc.includes('heart') || lowerDesc.includes('love')) {
                    ctx.fillText('‚ù§Ô∏è', width/2, height/2);
                } else if (lowerDesc.includes('fire') || lowerDesc.includes('hot')) {
                    ctx.fillText('üî•', width/2, height/2);
                } else if (lowerDesc.includes('lightning') || lowerDesc.includes('bolt')) {
                    ctx.fillText('‚ö°', width/2, height/2);
                } else if (lowerDesc.includes('rocket') || lowerDesc.includes('launch')) {
                    ctx.fillText('üöÄ', width/2, height/2);
                } else if (lowerDesc.includes('crown') || lowerDesc.includes('king')) {
                    ctx.fillText('üëë', width/2, height/2);
                } else if (lowerDesc.includes('diamond') || lowerDesc.includes('gem')) {
                    ctx.fillText('üíé', width/2, height/2);
                } else {
                    // Default Helm logo
                    ctx.fillText('üõ°Ô∏è', width/2, height/2);
                }
                
                // Text label
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('HELM', width/2, height - 20);
            };
            
            const createPokerLogo = (ctx, width, height) => {
                // Poker logo design
                const gradient = ctx.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, '#1a1a2e');
                gradient.addColorStop(1, '#16213e');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Cards background
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(20, 20, width-40, height-40);
                
                // Playing cards
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(30, 40, 40, 60);
                ctx.fillRect(130, 40, 40, 60);
                
                // Card suits
                ctx.fillStyle = '#e74c3c';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ô•Ô∏è', 50, 70);
                ctx.fillText('‚ô†Ô∏è', 150, 70);
                
                // Poker chips
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(50, 120, 20, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(100, 120, 20, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.arc(150, 120, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Title
                ctx.fillStyle = '#667eea';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('POKER', width/2, height - 25);
            };
            
            const createAudio = (description) => {
                const lowerDesc = description.toLowerCase();
                
                if (lowerDesc.includes('card shuffle') || lowerDesc.includes('shuffle')) {
                    createCardShuffleSound();
                } else if (lowerDesc.includes('chip sound') || lowerDesc.includes('chip noise')) {
                    createChipSound();
                } else if (lowerDesc.includes('win') || lowerDesc.includes('victory')) {
                    createWinSound();
                } else if (lowerDesc.includes('lose') || lowerDesc.includes('defeat')) {
                    createLoseSound();
                } else if (lowerDesc.includes('deal') || lowerDesc.includes('dealing')) {
                    createDealSound();
                } else if (lowerDesc.includes('bet') || lowerDesc.includes('wager')) {
                    createBetSound();
                } else if (lowerDesc.includes('background') || lowerDesc.includes('music') || lowerDesc.includes('ambient')) {
                    createBackgroundMusic();
                } else if (lowerDesc.includes('alert') || lowerDesc.includes('notification')) {
                    createAlertSound();
                } else {
                    createBackgroundMusic(); // Default
                }
                
                // Create pending asset for approval
                const pendingAsset = {
                    id: Date.now(),
                    type: 'audio',
                    assetType: getAudioType(lowerDesc),
                    description: description,
                    audioUrl: currentAudioUrl,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                setPendingAssets(prev => [...prev, pendingAsset]);
                
                // Add approval message
                const approvalMessage = {
                    content: `Poker ${getAudioType(lowerDesc)} created! Review and approve to implement:`,
                    isUser: false,
                    timestamp: new Date().toISOString(),
                    isApproval: true,
                    assetId: pendingAsset.id,
                    audioUrl: currentAudioUrl
                };
                
                setMessages(prev => [...prev, approvalMessage]);
            };
            
            const getAudioType = (desc) => {
                if (desc.includes('shuffle')) return 'Shuffle Sound';
                if (desc.includes('chip')) return 'Chip Sound';
                if (desc.includes('win')) return 'Win Sound';
                if (desc.includes('lose')) return 'Lose Sound';
                if (desc.includes('deal')) return 'Deal Sound';
                if (desc.includes('bet')) return 'Bet Sound';
                if (desc.includes('background') || desc.includes('music')) return 'Background Music';
                if (desc.includes('alert') || desc.includes('notification')) return 'Alert Sound';
                return 'Audio';
            };
            
            let currentAudioUrl = null;
            
            // Audio generation functions
            const createCardShuffleSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 1.5;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create realistic card shuffle sound
                    if (Math.random() < 0.02) {
                        data[i] = (Math.random() - 0.5) * 0.3; // Random noise
                    } else {
                        data[i] = Math.sin(i * 0.02) * 0.1 * Math.exp(-i * 0.001) * Math.random();
                    }
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createChipSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 0.3;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create chip click sound
                    data[i] = Math.sin(i * 0.5) * 0.8 * Math.exp(-i * 0.01);
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createWinSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 2.0;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create celebratory win sound
                    const t = i / sampleRate;
                    data[i] = (Math.sin(440 * t) * 0.3 + Math.sin(880 * t) * 0.2) * Math.exp(-t * 0.5) +
                              (Math.sin(220 * t) * 0.4 + Math.sin(660 * t) * 0.3) * Math.exp(-t * 0.3);
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createLoseSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 1.0;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create sad lose sound
                    const t = i / sampleRate;
                    data[i] = (Math.sin(200 * t) * 0.2 * Math.exp(-t * 0.8)) +
                              (Math.sin(100 * t) * 0.1 * Math.exp(-t * 0.5));
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createDealSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 0.8;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create card dealing sound
                    if (i < 100) {
                        data[i] = Math.random() * 0.1 - 0.05; // Quick swoosh
                    } else {
                        data[i] = 0;
                    }
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createBetSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 0.4;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create bet placement sound
                    data[i] = Math.sin(i * 0.8) * 0.3 * Math.exp(-i * 0.01);
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createBackgroundMusic = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 10.0;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create ambient poker background music
                    const t = i / sampleRate;
                    data[i] = (Math.sin(110 * t) * 0.1 + Math.sin(220 * t) * 0.05) * 0.3 +
                              (Math.sin(330 * t) * 0.08 * 0.2) +
                              (Math.sin(440 * t) * 0.06 * 0.15);
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const createAlertSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 0.5;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(1, sampleRate * duration, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < data.length; i++) {
                    // Create alert notification sound
                    const t = i / sampleRate;
                    data[i] = Math.sin(880 * t) * 0.2 * Math.exp(-t * 0.3);
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                currentAudioUrl = URL.createObjectURL(blob);
            };
            
            const approveAsset = (assetId) => {
                const asset = pendingAssets.find(a => a.id === assetId);
                if (!asset) return;
                
                // Implement the asset
                implementAsset(asset);
                
                // Update status
                setPendingAssets(prev => prev.map(a => 
                    a.id === assetId ? { ...a, status: 'approved' } : a
                ));
                
                // Add implementation message
                const implMessage = {
                    content: `‚úÖ ${asset.assetType} approved and implemented!`,
                    isUser: false,
                    timestamp: new Date().toISOString(),
                    isImplementation: true,
                    assetId: assetId
                };
                
                setMessages(prev => [...prev, implMessage]);
            };
            
            const rejectAsset = (assetId) => {
                // Update status
                setPendingAssets(prev => prev.map(a => 
                    a.id === assetId ? { ...a, status: 'rejected' } : a
                ));
                
                // Add rejection message
                const rejectMessage = {
                    content: `‚ùå Asset rejected. You can create a new one if needed.`,
                    isUser: false,
                    timestamp: new Date().toISOString(),
                    isImplementation: true,
                    assetId: assetId
                };
                
                setMessages(prev => [...prev, rejectMessage]);
            };
            
            const implementAsset = async (asset) => {
                try {
                    // Simulate implementation (in real scenario, this would save files)
                    console.log('Implementing asset:', asset);
                    
                    // For demonstration, we'll just show what would happen
                    const implementationDetails = {
                        image: {
                            folder: `assets/${asset.assetType.toLowerCase().replace(' ', '-')}/`,
                            filename: `${asset.assetType.toLowerCase().replace(' ', '-')}-${Date.now()}.png`,
                            component: `components/${asset.assetType.replace(' ', '')}.jsx`,
                            styles: `styles/${asset.assetType.toLowerCase().replace(' ', '')}.css`
                        },
                        audio: {
                            folder: `assets/audio/`,
                            filename: `${asset.assetType.toLowerCase().replace(' ', '-')}-${Date.now()}.wav`,
                            component: `components/AudioPlayer.jsx`,
                            integration: 'integrated with game sound system'
                        }
                    };
                    
                    const details = implementationDetails[asset.type];
                    
                    // Add detailed implementation message
                    const detailMessage = {
                        content: `üìÅ Implementation Details:\n‚Ä¢ Saved to: ${details.folder}\n‚Ä¢ Filename: ${details.filename}\n‚Ä¢ Component: ${details.component}\n‚Ä¢ Ready to use in your poker game!`,
                        isUser: false,
                        timestamp: new Date().toISOString(),
                        isImplementation: true,
                        assetId: asset.id
                    };
                    
                    setTimeout(() => {
                        setMessages(prev => [...prev, detailMessage]);
                    }, 1000);
                    
                } catch (error) {
                    console.error('Implementation error:', error);
                }
            };
            
            // File upload functions
            const handleFileUpload = (files) => {
                const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'audio/wav', 'audio/mp3', 'audio/mpeg', 'audio/ogg'];
                const validFiles = Array.from(files).filter(file => validTypes.includes(file.type));
                
                if (validFiles.length === 0) {
                    alert('Please upload only images (JPG, PNG, GIF, WebP) or audio files (WAV, MP3, OGG)');
                    return;
                }
                
                const newFiles = validFiles.map(file => ({
                    id: Date.now() + Math.random(),
                    file: file,
                    name: file.name,
                    type: file.type.startsWith('image/') ? 'image' : 'audio',
                    url: URL.createObjectURL(file),
                    size: file.size,
                    timestamp: new Date().toISOString()
                }));
                
                setUploadedFiles(prev => [...prev, ...newFiles]);
                
                // Add upload confirmation message
                const uploadMessage = {
                    content: `üìÅ Files uploaded successfully:\n${newFiles.map(f => `‚Ä¢ ${f.name} (${f.type})`).join('\n')}\n\nYou can now reference these files when creating new assets!`,
                    isUser: false,
                    timestamp: new Date().toISOString(),
                    isUpload: true
                };
                
                setMessages(prev => [...prev, uploadMessage]);
            };
            
            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragging(true);
            };
            
            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDragging(false);
            };
            
            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                handleFileUpload(e.dataTransfer.files);
            };
            
            const removeUploadedFile = (fileId) => {
                setUploadedFiles(prev => prev.filter(f => f.id !== fileId));
            };
            
            const formatFileSize = (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };
            
            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };
            
            return (
                <div className="dashboard-container">
                    <div className="header">
                        <h1>üõ°Ô∏è Helm Enhanced Chat</h1>
                        <p>Natural AI conversation with smart model selection</p>
                    </div>
                    
                    <div className="status-bar">
                        <div className="status-item">
                            <div>ü§ñ Helm Status</div>
                            <div>{helmStatus.running ? 'üü¢ Online' : 'üî¥ Offline'}</div>
                        </div>
                        <div className="status-item">
                            <div>üß† Learning</div>
                            <div>{helmStatus.running ? 'üü¢ Active' : 'üî¥ Inactive'}</div>
                        </div>
                        <div className="status-item">
                            <div>üí¨ Messages</div>
                            <div>{messages.length}</div>
                        </div>
                    </div>
                    
                    <div className="chat-section">
                        <h2>üí¨ Chat with Helm</h2>
                        
                        <div className="chat-container">
                            {messages.map((message, index) => (
                                <div key={index} className={`message-bubble ${message.isUser ? 'user' : 'assistant'}`}>
                                    {!message.isUser && (
                                        <div className="message-avatar">üõ°Ô∏è</div>
                                    )}
                                    <div className="message-content">
                                        {message.isApproval ? (
                                            <div>
                                                {message.imageUrl && (
                                                    <img 
                                                        src={message.imageUrl} 
                                                        alt="Generated Asset" 
                                                        style={{
                                                            maxWidth: '100%',
                                                            borderRadius: '8px',
                                                            border: '2px solid #3a3a5e',
                                                            marginBottom: '8px'
                                                        }}
                                                    />
                                                )}
                                                {message.audioUrl && (
                                                    <audio 
                                                        controls 
                                                        style={{
                                                            width: '100%',
                                                            borderRadius: '8px',
                                                            marginBottom: '8px'
                                                        }}
                                                    >
                                                        <source src={message.audioUrl} type="audio/wav" />
                                                        Your browser does not support the audio element.
                                                    </audio>
                                                )}
                                                <div style={{ marginBottom: '10px' }}>{message.content}</div>
                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                    <button
                                                        onClick={() => approveAsset(message.assetId)}
                                                        style={{
                                                            padding: '6px 12px',
                                                            background: 'linear-gradient(135deg, #10b981, #059669)',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px',
                                                            fontWeight: '500'
                                                        }}
                                                    >
                                                        ‚úÖ Approve & Implement
                                                    </button>
                                                    <button
                                                        onClick={() => rejectAsset(message.assetId)}
                                                        style={{
                                                            padding: '6px 12px',
                                                            background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px',
                                                            fontWeight: '500'
                                                        }}
                                                    >
                                                        ‚ùå Reject
                                                    </button>
                                                </div>
                                            </div>
                                        ) : message.isImplementation ? (
                                            <div style={{
                                                background: 'rgba(16, 185, 129, 0.1)',
                                                border: '1px solid #10b981',
                                                borderRadius: '8px',
                                                padding: '12px',
                                                whiteSpace: 'pre-line'
                                            }}>
                                                {message.content}
                                            </div>
                                        ) : message.isUpload ? (
                                            <div style={{
                                                background: 'rgba(59, 130, 246, 0.1)',
                                                border: '1px solid #3b82f6',
                                                borderRadius: '8px',
                                                padding: '12px',
                                                whiteSpace: 'pre-line'
                                            }}>
                                                {message.content}
                                            </div>
                                        ) : (
                                            <div>{message.content}</div>
                                        )}
                                        <div className="message-time">
                                            {new Date(message.timestamp).toLocaleTimeString()}
                                        </div>
                                    </div>
                                    {message.isUser && (
                                        <div className="message-avatar">üë§</div>
                                    )}
                                </div>
                            ))}
                            
                            {isLoading && (
                                <div className="message-bubble assistant">
                                    <div className="message-avatar">üõ°Ô∏è</div>
                                    <div className="message-content">
                                        <div className="typing-indicator">
                                            <div className="typing-dot"></div>
                                            <div className="typing-dot"></div>
                                            <div className="typing-dot"></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="chat-input-container">
                            <button 
                                className="upload-button" 
                                onClick={() => setShowUploadModal(true)}
                                title="Upload files for reference"
                            >
                                üìÅ Upload
                            </button>
                            <input
                                type="text"
                                className="chat-input"
                                placeholder="Type your message..."
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={handleKeyPress}
                                disabled={isLoading}
                            />
                            <select 
                                className="model-select"
                                value={selectedModel} 
                                onChange={(e) => setSelectedModel(e.target.value)}
                            >
                                {availableModels.map(model => (
                                    <option key={model} value={model}>{model}</option>
                                ))}
                            </select>
                            <button 
                                className="send-button" 
                                onClick={sendMessage}
                                disabled={isLoading || !input.trim()}
                            >
                                {isLoading ? '‚è≥ Thinking...' : 'üöÄ Send'}
                            </button>
                        </div>
                    </div>
                    
                    <div className="logo-display">
                        <canvas id="logo-canvas" width="200" height="200" style={{ display: 'none' }}></canvas>
                    </div>
                    
                    {/* Upload Modal */}
                    {showUploadModal && (
                        <div className="upload-modal">
                            <div className="upload-modal-content">
                                <div className="upload-modal-header">
                                    <h3 className="upload-modal-title">üìÅ Upload Files for Reference</h3>
                                    <button 
                                        className="close-modal-btn"
                                        onClick={() => setShowUploadModal(false)}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div 
                                    className={`file-upload-area ${isDragging ? 'dragging' : ''}`}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    onClick={() => document.getElementById('modal-file-input').click()}
                                >
                                    <div className="file-upload-icon">üìÅ</div>
                                    <div className="file-upload-text">
                                        {isDragging ? 'Drop files here...' : 'Click to upload or drag & drop'}
                                    </div>
                                    <div className="file-upload-hint">
                                        Images (JPG, PNG, GIF, WebP) ‚Ä¢ Audio (WAV, MP3, OGG)
                                    </div>
                                    <input
                                        id="modal-file-input"
                                        type="file"
                                        className="file-input"
                                        multiple
                                        accept="image/*,audio/*"
                                        onChange={(e) => {
                                            handleFileUpload(e.target.files);
                                            setShowUploadModal(false);
                                        }}
                                    />
                                </div>
                                
                                {uploadedFiles.length > 0 && (
                                    <div className="uploaded-files">
                                        <div style={{ color: '#e0e0e0', marginBottom: '10px', fontSize: '14px' }}>
                                            üìã Uploaded Files ({uploadedFiles.length}):
                                        </div>
                                        {uploadedFiles.map(file => (
                                            <div key={file.id} className="uploaded-file">
                                                <div className="uploaded-file-info">
                                                    <div className="uploaded-file-icon">
                                                        {file.type === 'image' ? 'üñºÔ∏è' : 'üéµ'}
                                                    </div>
                                                    {file.type === 'image' && (
                                                        <img 
                                                            src={file.url} 
                                                            alt={file.name}
                                                            className="uploaded-file-preview"
                                                        />
                                                    )}
                                                    <div className="uploaded-file-details">
                                                        <div className="uploaded-file-name">{file.name}</div>
                                                        <div className="uploaded-file-size">{formatFileSize(file.size)}</div>
                                                    </div>
                                                </div>
                                                <button
                                                    className="remove-file-btn"
                                                    onClick={() => removeUploadedFile(file.id)}
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app using React 18 createRoot API
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EnhancedHelmChat />);
    </script>
</body>
</html>
